@model MedicacionesPaciente
@{
    ViewData["Title"] = "Agregar Medicamento";
}

<main class="agregar-medicamento-main">
    <section class="agregar-medicamento-header">
        <h1>Agregar Nuevo Medicamento</h1>
    </section>

    <section class="agregar-medicamento-form-container">
        <form asp-action="Agregar" asp-controller="Home" method="post" class="agregar-medicamento-form">
            @Html.AntiForgeryToken()

            @* IdUsuario y IdReceta se manejan en el controlador *@
            <input asp-for="IdUsuario" type="hidden" />
            <input asp-for="IdReceta" type="hidden" value="0" />

            <!-- ================= RECETA OPCIONAL ================= -->
            <div class="campo-grupo">
                <label>
                    <input type="checkbox" id="chkAgregarReceta" name="AgregarReceta" />
                    Agregar datos de receta médica (opcional)
                </label>
                <small style="display: block; color: #666; margin-top: 5px;">
                    Si no marcas esta opción, se creará una receta sin datos del médico.
                </small>
            </div>

            <div id="seccion-receta" style="display: none;">
                <h2>Datos de la receta</h2>

                <div class="campo-grupo">
                    <label for="NombreMedico">Nombre del médico: *</label>
                    <input id="NombreMedico" name="NombreMedico" class="form-control" />
                </div>

                <div class="campo-grupo">
                    <label for="ApellidoMedico">Apellido del médico:</label>
                    <input id="ApellidoMedico" name="ApellidoMedico" class="form-control" />
                </div>

                <div class="campo-grupo">
                    <label for="FechaEmision">Fecha de emisión: *</label>
                    <input id="FechaEmision" name="FechaEmision" type="date" class="form-control" />
                </div>

                <div class="campo-grupo">
                    <label for="FechaCaducacion">Fecha de caducación: *</label>
                    <input id="FechaCaducacion" name="FechaCaducacion" type="date" class="form-control" />
                </div>

                <div class="campo-grupo">
                    <label for="Observaciones">Observaciones:</label>
                    <textarea id="Observaciones" name="Observaciones" class="form-control"></textarea>
                </div>
            </div>

            <hr />

            <!-- ============== DATOS DEL MEDICAMENTO ================= -->
            <h2>Datos del medicamento</h2>

            <div class="campo-grupo">
                <label asp-for="Nombre_Comercial">Nombre Comercial:</label>
                <input asp-for="Nombre_Comercial" class="form-control" />
                <span asp-validation-for="Nombre_Comercial" class="text-danger"></span>
            </div>

            <div class="campo-grupo">
                <label asp-for="Dosis">Dosis:</label>
                <input asp-for="Dosis" class="form-control" />
                <span asp-validation-for="Dosis" class="text-danger"></span>
            </div>

            <div class="campo-grupo">
                <label asp-for="Via">Vía:</label>
                <input asp-for="Via" class="form-control" />
                <span asp-validation-for="Via" class="text-danger"></span>
            </div>

            <div class="campo-grupo">
                <label asp-for="Frecuencia">Frecuencia:</label>
                <input asp-for="Frecuencia" class="form-control" />
                <span asp-validation-for="Frecuencia" class="text-danger"></span>
            </div>

            <div class="campo-grupo">
                <label asp-for="Indicacion">Indicación:</label>
                <textarea asp-for="Indicacion" class="form-control"></textarea>
                <span asp-validation-for="Indicacion" class="text-danger"></span>
            </div>

            <div class="campo-grupo">
                <label asp-for="HoraProgramada">Hora de primera toma:</label>
                <input asp-for="HoraProgramada" type="time" step="60" class="form-control" 
                       value="@(Model.HoraProgramada?.ToString("HH:mm"))" />
                <span asp-validation-for="HoraProgramada" class="text-danger"></span>
            </div>

            <div class="campo-grupo">
                <label asp-for="FechaFabricacion">Fecha Fabricación:</label>
                <input asp-for="FechaFabricacion" type="date" class="form-control" />
                <span asp-validation-for="FechaFabricacion" class="text-danger"></span>
            </div>

            <div class="campo-grupo">
                <label asp-for="FechaVencimiento">Fecha Vencimiento:</label>
                <input asp-for="FechaVencimiento" type="date" class="form-control" />
                <span asp-validation-for="FechaVencimiento" class="text-danger"></span>
            </div>

            <div class="campo-grupo">
                <label asp-for="Estado">Estado:</label>
                <input asp-for="Estado" type="checkbox" class="form-check-input" />
                <span asp-validation-for="Estado" class="text-danger"></span>
            </div>

            <div class="form-buttons">
                <button type="submit" class="btn-primary">Agregar Medicamento</button>
                <a asp-action="Medicamentos" asp-controller="Home" class="btn-secondary">Cancelar</a>
            </div>
        </form>
    </section>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const checkbox = document.getElementById('chkAgregarReceta');
        const seccionReceta = document.getElementById('seccion-receta');
        
        if (checkbox && seccionReceta) {
            checkbox.addEventListener('change', function() {
                seccionReceta.style.display = this.checked ? 'block' : 'none';
                
                // Si se desmarca, limpiar los campos
                if (!this.checked) {
                    document.getElementById('NombreMedico').value = '';
                    document.getElementById('ApellidoMedico').value = '';
                    document.getElementById('FechaEmision').value = '';
                    document.getElementById('FechaCaducacion').value = '';
                    document.getElementById('Observaciones').value = '';
                }
            });
        }
    });
</script>
