@{
    ViewData["Title"] = "Mis Medicamentos - VitaLink";
    var medicaciones = ViewBag.Medicaciones as List<MedicacionesPaciente>;
}

<main class="medicamentos-main">
    <section>
        <h1>Mis medicamentos</h1>
    </section>

    <section class="medicamentos-lista">
        @if (medicaciones != null && medicaciones.Count > 0)
        {
            @foreach (var medicamento in medicaciones)
            {
                <article class="medicamento-card">
                    <div class="medicamento-contenido">
                        <div class="medicamento-info">
                            <h2>@medicamento.Nombre_Comercial</h2>
                            <div class="medicamento-detalles">
                                <p>
                                    <span>Horario:</span>
                                    <span>@medicamento.HoraProgramada?.ToString("HH:mm")</span>
                                </p>
                                <p>
                                    <span>Cantidad:</span>
                                    <span>@medicamento.Dosis</span>
                                </p>
                                <p>
                                    <span>Regularidad:</span>
                                    <span>@medicamento.Frecuencia</span>
                                </p>
                                <div class="medicamento-indicaciones" onclick="toggleIndicaciones(this)">
                                    <span>Indicaciones</span>
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M6 9l6 6 6-6"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="medicamento-icono">
                            <svg width="80" height="80" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="30" cy="50" r="15" fill="white" opacity="0.9"/>
                                <circle cx="70" cy="50" r="15" fill="white" opacity="0.9"/>
                                <rect x="30" y="35" width="40" height="30" rx="5" fill="white" opacity="0.7"/>
                            </svg>
                        </div>
                    </div>
                    <div class="medicamento-acciones">
                        <div class="medicamento-botones">
                            <button class="btn-icono" title="Editar" onclick="abrirModalMedicamento(@medicamento.Id, '@medicamento.Nombre_Comercial', '@medicamento.Dosis', '@medicamento.Frecuencia', '@medicamento.HoraProgramada?.ToString("HH:mm")', '@medicamento.Indicacion?.Replace("'", "\\'")?.Replace("\n", "\\n")')">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                            <button class="btn-icono" title="Eliminar" onclick="confirmarEliminarMedicamento(@medicamento.Id)">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                            </button>
                        </div>
                        <button class="btn-recordatorio">Activar recordatorio</button>
                    </div>
                    <div class="medicamento-indicaciones-detalle">
                        <p>@medicamento.Indicacion</p>
                    </div>
                </article>
            }
        }
        else
        {
            <div class="medicamentos-vacio">
                <p>El pastillero está vacío</p>
            </div>
        }
    </section>

    <section class="medicamentos-acciones-bottom">
        <a href="@Url.Action("Agregar", "Home")" class="btn-agregar">Agregar</a>
    </section>
</main>

<!-- Modal para editar medicamento -->
<div id="modal-medicamento" class="modal-overlay">
    <div class="modal-content modal-medicamento">
        <header>
            <h2>Editar Medicamento</h2>
            <button onclick="cerrarModalMedicamento()">&times;</button>
        </header>
        <div class="modal-body">
            <input type="hidden" id="med-id" />
            <div class="campo-grupo">
                <label for="med-nombre">Nombre:</label>
                <input type="text" id="med-nombre" />
            </div>
            <div class="campo-grupo">
                <label for="med-dosis">Dosis/Cantidad:</label>
                <input type="text" id="med-dosis" />
            </div>
            <div class="campo-grupo">
                <label for="med-frecuencia">Frecuencia:</label>
                <input type="text" id="med-frecuencia" />
            </div>
            <div class="campo-grupo">
                <label for="med-hora">Horario:</label>
                <input type="time" id="med-hora" />
            </div>
            <div class="campo-grupo">
                <label for="med-indicacion">Indicaciones:</label>
                <textarea id="med-indicacion" rows="3"></textarea>
            </div>
        </div>
        <footer>
            <button class="btn-cancelar" onclick="cerrarModalMedicamento()">Cancelar</button>
            <button class="btn-guardar" onclick="guardarMedicamento()">Guardar</button>
        </footer>
    </div>
</div>
