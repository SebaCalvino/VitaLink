@{
    ViewData["Title"] = "Perfil";
    var usuario = ViewBag.Usuario as Usuario;
    var alergias = ViewBag.Alergias as List<Alergia> ?? new List<Alergia>();
    var diagnosticos = ViewBag.Diagnosticos as List<Diagnostico> ?? new List<Diagnostico>();
    
    var enfermedadesActuales = diagnosticos.Where(d => d.Estado == true).ToList();
    var enfermedadesRelevantes = diagnosticos.ToList();
}

<main class="Perfil-App">
    
    <section class="Perfil-Foto">
        <figure class="perfil-icon-container">
            <svg class="perfil-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="11" stroke="white" stroke-width="1" fill="white"/>
                <path d="M12 11c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3zm0 1c-2 0-6 1-6 3v2h12v-2c0-2-4-3-6-3z" fill="#4A9B8C"/>
            </svg>
        </figure>
        <a href="@Url.Action("EditarPerfil", "Home")" class="btn-editar-perfil">Editar Perfil</a>
    </section>

    <section class="Perfil-InfoPrincipal">
        <h2>Informacion Principal</h2>
        
        <div class="Info-Basica">
            @if (usuario?.PesoEnKg > 0)
            {
                <span class="info-tag">@($"{usuario.PesoEnKg}kg")</span>
            }
            @if (usuario?.AlturaEnCm > 0)
            {
                <span class="info-tag">@($"{usuario.AlturaEnCm}cm")</span>
            }
            @if (usuario?.FechaNacimiento != default)
            {
                <span class="info-tag">@usuario.FechaNacimiento.ToString("dd/MM/yyyy")</span>
            }
        </div>

        <article class="Perfil-Alergias">
            <h3>Alergias:</h3>
            @if (alergias.Any())
            {
                <div class="tags-container">
                    @foreach (var alergia in alergias)
                    {
                        <span class="info-tag">@alergia.Reaccion</span>
                    }
                </div>
            }
            else
            {
                <p class="sin-info">No hay información sobre: alergias</p>
            }
        </article>

        <article class="Perfil-Enfermedad">
            <h3>Enfermedad:</h3>
            @if (enfermedadesActuales.Any())
            {
                <div class="tags-container">
                    @foreach (var enfermedad in enfermedadesActuales)
                    {
                        <span class="info-tag">@(enfermedad.NombrePatologia ?? enfermedad.Descripcion)</span>
                    }
                </div>
            }
            else
            {
                <p class="sin-info">Te encuentras en perfecta salud</p>
            }
        </article>
    </section>

    <section class="Perfil-EnfermedadesRelevantes">
        <h2>Enfermedades Relevantes</h2>
        
        @if (enfermedadesRelevantes.Any())
        {
            <ul class="enfermedades-lista">
                @foreach (var enfermedad in enfermedadesRelevantes)
                {
                    <li>
                        <div class="enfermedad-item">
                            <span class="enfermedad-nombre">@(enfermedad.NombrePatologia ?? enfermedad.Descripcion)</span>
                            @if (enfermedad.FechaFin == default || enfermedad.FechaFin > DateTime.Now)
                            {
                                <span class="enfermedad-fecha">Cronica</span>
                            }
                            else
                            {
                                <time class="enfermedad-fecha" datetime="@enfermedad.FechaInicio.ToString("yyyy-MM-dd")">
                                    @enfermedad.FechaInicio.ToString("dd/MM/yyyy")
                                </time>
                            }
                        </div>
                    </li>
                }
            </ul>
        }
        else
        {
            <p class="sin-info">No hay información sobre: enfermedades relevantes</p>
        }
    </section>

    <section class="Perfil-CerrarSesion">
        <a href="@Url.Action("CerrarSesion", "Home")" class="btn-cerrar-sesion">Cerrar Sesión</a>
    </section>

</main>
